<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2019-06-14 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190614" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Obevo &#x2013; Error Handling</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                      <a href="https://github.com/goldmansachs/obevo">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Intro">Intro</a></li>
            <li><a href="overview.html" title="Overview">Overview</a></li>
            <li><a href="setup.html" title="Setup">Setup</a></li>
            <li><a href="support.html" title="Help and Support">Help and Support</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a></li>
            <li><a href="environment-management.html" title="Environment Management">Environment Management</a></li>
            <li><a href="permission-management.html" title="Permission Management">Permission Management</a></li>
            <li><a href="error-handling.html" title="Error-Handling">Error-Handling</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="command-line-api.html" title="Command-line API">Command-line API</a></li>
            <li><a href="java-api.html" title="Java API">Java API</a></li>
            <li><a href="maven-api.html" title="Maven plugin API">Maven plugin API</a></li>
            <li><a href="gradle-api.html" title="Gradle API">Gradle API</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced Topics <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a></li>
            <li><a href="rollback.html" title="Rollback">Rollback</a></li>
            <li><a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a></li>
            <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging">Separate Schema and Config Packaging</a></li>
            <li><a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a></li>
            <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a></li>
            <li><a href="orm-integration.html" title="ORM Integration">ORM Integration</a></li>
            <li><a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a></li>
            <li><a href="phased-deployments.html" title="Phased Deployments">Phased Deployments</a></li>
            <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform-Specific Details <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="platform-listing.html" title="Platform Listing">Platform Listing</a></li>
            <li><a href="db2-notes.html" title="DB2">DB2</a></li>
            <li><a href="general-db-notes.html" title="HSQLDB">HSQLDB</a></li>
            <li><a href="general-db-notes.html" title="H2">H2</a></li>
            <li><a href="mongodb-notes.html" title="MongoDB">MongoDB</a></li>
            <li><a href="oracle-notes.html" title="Oracle">Oracle</a></li>
            <li><a href="postgresql-notes.html" title="PostgreSQL">PostgreSQL</a></li>
            <li><a href="redshift-notes.html" title="Redshift">Redshift</a></li>
            <li><a href="sybase-ase-notes.html" title="SQL Server">SQL Server</a></li>
            <li><a href="sybase-ase-notes.html" title="Sybase ASE">Sybase ASE</a></li>
            <li><a href="general-db-notes.html" title="Sybase IQ">Sybase IQ</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onboarding Guide <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a></li>
            <li><a href="new-onboarding-guide.html" title="New Systems">New Systems</a></li>
            <li><a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a></li>
            <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards">Existing Systems with Diverging Shards</a></li>
            <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a></li>
            <li><a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Information <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
              <ul class="dropdown-menu">
                  <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup">Docker-based Test DB Setup</a></li>
                  <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup">Amazon RDS DB Setup</a></li>
                  <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup">Sybase ASE Test DB Setup</a></li>
              </ul>
            </li>
            <li><a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a></li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="./" id="bannerLeft"><h2>Obevo</h2>
</a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li class=""><a href="./" title="Obevo">Obevo</a><span class="divider">/</span></li>
    <li class="active ">Error Handling</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-06-14</li>
          <li id="projectVersion" class="pull-right">Version: master-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Getting Started</li>
    <li><a href="index.html" title="Intro"><span class="none"></span>Intro</a>  </li>
    <li><a href="overview.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="setup.html" title="Setup"><span class="none"></span>Setup</a>  </li>
    <li><a href="support.html" title="Help and Support"><span class="none"></span>Help and Support</a>  </li>
          <li class="nav-header">Technical Documentation</li>
    <li><a href="db-project-structure.html" title="DB Project Structure"><span class="none"></span>DB Project Structure</a>  </li>
    <li><a href="environment-management.html" title="Environment Management"><span class="none"></span>Environment Management</a>  </li>
    <li><a href="permission-management.html" title="Permission Management"><span class="none"></span>Permission Management</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Error-Handling</a>
  </li>
          <li class="nav-header">API Documentation</li>
    <li><a href="command-line-api.html" title="Command-line API"><span class="none"></span>Command-line API</a>  </li>
    <li><a href="java-api.html" title="Java API"><span class="none"></span>Java API</a>  </li>
    <li><a href="maven-api.html" title="Maven plugin API"><span class="none"></span>Maven plugin API</a>  </li>
    <li><a href="gradle-api.html" title="Gradle API"><span class="none"></span>Gradle API</a>  </li>
          <li class="nav-header">Advanced Topics</li>
    <li><a href="db-project-best-practices.html" title="DB Project Best Practices"><span class="none"></span>DB Project Best Practices</a>  </li>
    <li><a href="rollback.html" title="Rollback"><span class="none"></span>Rollback</a>  </li>
    <li><a href="multiple-schema-management.html" title="Multiple Schema Management"><span class="none"></span>Multiple Schema Management</a>  </li>
    <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging"><span class="none"></span>Separate Schema and Config Packaging</a>  </li>
    <li><a href="in-memory-db-testing.html" title="In-memory DB Testing"><span class="none"></span>In-memory DB Testing</a>  </li>
    <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution"><span class="none"></span>Parallel Deploy Execution</a>  </li>
    <li><a href="orm-integration.html" title="ORM Integration"><span class="none"></span>ORM Integration</a>  </li>
    <li><a href="baseline-validation.html" title="Baseline DDL Validation"><span class="none"></span>Baseline DDL Validation</a>  </li>
    <li><a href="phased-deployments.html" title="Phased Deployments"><span class="none"></span>Phased Deployments</a>  </li>
    <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup"><span class="none"></span>Incremental Change Code Cleanup</a>  </li>
          <li class="nav-header">Platform-Specific Details</li>
    <li><a href="platform-listing.html" title="Platform Listing"><span class="none"></span>Platform Listing</a>  </li>
    <li><a href="db2-notes.html" title="DB2"><span class="none"></span>DB2</a>  </li>
    <li><a href="general-db-notes.html" title="HSQLDB"><span class="none"></span>HSQLDB</a>  </li>
    <li><a href="general-db-notes.html" title="H2"><span class="none"></span>H2</a>  </li>
    <li><a href="mongodb-notes.html" title="MongoDB"><span class="none"></span>MongoDB</a>  </li>
    <li><a href="oracle-notes.html" title="Oracle"><span class="none"></span>Oracle</a>  </li>
    <li><a href="postgresql-notes.html" title="PostgreSQL"><span class="none"></span>PostgreSQL</a>  </li>
    <li><a href="redshift-notes.html" title="Redshift"><span class="none"></span>Redshift</a>  </li>
    <li><a href="sybase-ase-notes.html" title="SQL Server"><span class="none"></span>SQL Server</a>  </li>
    <li><a href="sybase-ase-notes.html" title="Sybase ASE"><span class="none"></span>Sybase ASE</a>  </li>
    <li><a href="general-db-notes.html" title="Sybase IQ"><span class="none"></span>Sybase IQ</a>  </li>
          <li class="nav-header">Onboarding Guide</li>
    <li><a href="onboarding-guide.html" title="Which onboarding to choose?"><span class="none"></span>Which onboarding to choose?</a>  </li>
    <li><a href="new-onboarding-guide.html" title="New Systems"><span class="none"></span>New Systems</a>  </li>
    <li><a href="existing-onboarding-guide.html" title="Existing Systems"><span class="none"></span>Existing Systems</a>  </li>
    <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards"><span class="none"></span>Existing Systems with Diverging Shards</a>  </li>
    <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems"><span class="none"></span>Legacy Onboarding - Legacy Systems</a>  </li>
    <li><a href="db-merge-tool.html" title="DB Merge Tool"><span class="none"></span>DB Merge Tool</a>  </li>
          <li class="nav-header">Developer Information</li>
    <li><a href="developer-guide.html" title="Developer Guide"><span class="icon-chevron-down"></span>Developer Guide</a>
      <ul class="nav nav-list">
    <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup"><span class="none"></span>Docker-based Test DB Setup</a>  </li>
    <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup"><span class="none"></span>Amazon RDS DB Setup</a>  </li>
    <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup"><span class="none"></span>Sybase ASE Test DB Setup</a>  </li>
      </ul>
  </li>
    <li><a href="design-walkthrough.html" title="Design Walkthrough"><span class="none"></span>Design Walkthrough</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!--

    Copyright 2017 Goldman Sachs.
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

--><h1>Error Handling</h1>
<p>What do you do when you get a failure during your DB Deployment?</p>
<p>First, let&#x2019;s understand how Obevo behaves when exceptions occur. Then, let&#x2019;s discuss the problem resolution options.</p>
<hr />

<ul>
<li><a href="#Obevo_Error_Handling_Behavior">Obevo Error Handling Behavior</a>
<ul>
<li><a href="#Best-effort_execution">Best-effort execution</a></li>
<li><a href="#Transactionality_Considerations">Transactionality Considerations</a></li></ul></li>
<li><a href="#Error-handling_during_deployment">Error-handling during deployment</a>
<ul>
<li><a href="#Analyze_the_issue__Error_Code_Lookup">Analyze the issue / Error Code Lookup</a></li>
<li><a href="#Option_1_-_fix_the_underlying_environment_and_rerun">Option 1 - fix the underlying environment and rerun</a></li>
<li><a href="#Option_2_-_rollback_or_rollforward">Option 2 - rollback or rollforward</a></li></ul></li></ul>
<div class="section">
<h2><a name="Obevo_Error_Handling_Behavior"></a>Obevo Error Handling Behavior</h2>
<div class="section">
<h3><a name="Best-effort_execution"></a>Best-effort execution</h3>
<p>For each deployment activity, Obevo executes a set of changes. If a change is deployed successfully, then that status is marked in the DeployLog so that following deployments do not try to execute the same change.</p>
<p>For example:</p>

<ul>
  
<li>Version 1 of the DB package has changes C1, C2, C3 - assume all pertain to the same object. The deployment succeeds and marks all those as deployed in the log.</li>
  
<li>If we try another deployment, Obevo will detect no changes, as C1, C2, C3 are already marked in the DeployLog</li>
  
<li>Version 2 comes along w/ changes C1, C2, C3, C4, C5, C6, C7 - assume all pertain to the same object. It tries to deploy the difference: C4, C5, C6, C7.</li>
  
<li>Let&#x2019;s say C4 succeeds and then C5 fails. In that case, C4 will be in the DeployLog, C5 will not be, and C6 and C7 will not be (we will not even attempt to do C6 or C7)</li>
  
<li>When re-deploying V2, Obevo will see that C1 - C4 are already deployed, so it picks up where it left off (C5, C6, C7)</li>
</ul>
<p>We made special mention in that example that all those changes were in the same object. What if they were changes in different DB objects?</p>

<ul>
  
<li>Obevo will do a best effort to deploy all objects even if unrelated objects are failed</li>
  
<li>However, if a change fails for a particular object, then no other changes for that object will get executed</li>
</ul>
<p>Replaying the example above from version 2:</p>

<ul>
  
<li>Version 2 comes along w/ changes C1, C2, C3, C4, C5, C6, C7 - assume all pertain to the same object. It tries to deploy the difference: C4, C5, C6, C7.</li>
  
<li>Now, let&#x2019;s assume that C4, C5, C6 belong to ObjectA, and C7 belongs to ObjectB.</li>
  
<li>Same as above - let&#x2019;s say C4 succeeds and then C5 fails. We will not attempt to deploy C6 as it belonged to the same ObjectA as C5. However, C7 belongs to a different object, and so we do try to deploy that. Let&#x2019;s assume it succeeds.</li>
  
<li>When re-deploying V2, Obevo will see that C1, C2, C3, C4, <b>and C7</b> are already deployed, so it picks up what is remaining (C5, C6)</li>
</ul>
<p>Design note: There was some initial debate about this mode (the alternative is to just fail the whole deployment upon any exception); but there was a desire for this best-effort behavior as it made it easier and faster to resolve issues. The check to prevent successive changes within an object from proceeding was the safety feature that allowed the best-effort behavior to work well.</p></div>
<div class="section">
<h3><a name="Transactionality_Considerations"></a>Transactionality Considerations</h3>
<p>The above examples assume that each change C1, C2, ... can be executed atomically. It would be a problem if they weren&#x2019;t. e.g.</p>

<ul>
  
<li>Obevo only knows about the whole of each change</li>
  
<li>If C1 was executed partially, Obevo will try to execute the change from the beginning</li>
  
<li>Depending on how the change is written, its execution could end up failing</li>
</ul>
<p>This proves particularly interesting for DDL changes, as not all DBMS&#x2019;s may be configured to allow transactional execution of DDLs. Hence, if you need to perform a set of actions on a particular object, you should attempt to break it up in as fine grained change statements as possible.</p>
<p>For example: instead of</p>

<div class="source">
<div class="source"><pre class="prettyprint">//// CHANGE name=addColumns
ALTER TABLE myTable ADD COLUMN col1 INT
GO
ALTER TABLE myTable ADD COLUMN col2 INT
GO
ALTER TABLE myTable ADD COLUMN col3 INT
GO
</pre></div></div>
<p>do:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//// CHANGE name=addCol1
ALTER TABLE myTable ADD COLUMN col1 INT
GO
//// CHANGE name=addCol2
ALTER TABLE myTable ADD COLUMN col2 INT
GO
//// CHANGE name=addCol3
ALTER TABLE myTable ADD COLUMN col3 INT
GO
</pre></div></div>
<p>Understandably, the finer-grained the changes are, the more clutter that would exist in your code. This is the trade-off that you should think about. With Obevo, we strove to make it as easy as possible to split it up without too much clutter. (e.g. at least you can split this changes within the same file using some text syntax, instead of having to keep them in separate files as other DB Deployment tools may have you do)</p></div></div>
<div class="section">
<h2><a name="Error-handling_during_deployment"></a>Error-handling during deployment</h2>
<p>Now that we understand how Obevo behaves when encountering errors, here is guidance on how you should handle errors as a user</p>
<div class="section">
<h3><a name="Analyze_the_issue__Error_Code_Lookup"></a>Analyze the issue / Error Code Lookup</h3>
<p>Start w/ analyzing the exception message. Most databases will give error messages with a code and a message; use those as hints. e.g. googling <a class="externalLink" href="https://www.google.com/?gws_rd=ssl#q=db2+error+code+204">&quot;db2 error code[yourErrorCode]&quot;</a> will usually find you a page linking to the error description on IBM&#x2019;s page.</p>
<p>Once you&#x2019;ve diagnosed an issue, you have a couple options:</p></div>
<div class="section">
<h3><a name="Option_1_-_fix_the_underlying_environment_and_rerun"></a>Option 1 - fix the underlying environment and rerun</h3>
<p>At times, the error may be environmental and not something controllable from your DB code, e.g. users/groups not having been setup correctly, running out of disk space, and so on.</p>
<p>In such cases, fix the underlying issue and rerun the deployment. Per the Error Handling behavior description above, the deployment will pick up where it left off.</p>
<p>If this happens to fix the issue, then great. Otherwise, we move on to Option 2</p></div>
<div class="section">
<h3><a name="Option_2_-_rollback_or_rollforward"></a>Option 2 - rollback or rollforward</h3>
<p>This deserves its own page - see the <a href="rollback.html">Rollback Page</a> for more information.</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2019
<a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
