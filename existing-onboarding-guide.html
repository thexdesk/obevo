<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2019-06-14 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190614" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Obevo &#x2013; Full Onboarding Guide for Existing Systems</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                      <a href="https://github.com/goldmansachs/obevo">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Intro">Intro</a></li>
            <li><a href="overview.html" title="Overview">Overview</a></li>
            <li><a href="setup.html" title="Setup">Setup</a></li>
            <li><a href="support.html" title="Help and Support">Help and Support</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a></li>
            <li><a href="environment-management.html" title="Environment Management">Environment Management</a></li>
            <li><a href="permission-management.html" title="Permission Management">Permission Management</a></li>
            <li><a href="error-handling.html" title="Error-Handling">Error-Handling</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="command-line-api.html" title="Command-line API">Command-line API</a></li>
            <li><a href="java-api.html" title="Java API">Java API</a></li>
            <li><a href="maven-api.html" title="Maven plugin API">Maven plugin API</a></li>
            <li><a href="gradle-api.html" title="Gradle API">Gradle API</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced Topics <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a></li>
            <li><a href="rollback.html" title="Rollback">Rollback</a></li>
            <li><a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a></li>
            <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging">Separate Schema and Config Packaging</a></li>
            <li><a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a></li>
            <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a></li>
            <li><a href="orm-integration.html" title="ORM Integration">ORM Integration</a></li>
            <li><a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a></li>
            <li><a href="phased-deployments.html" title="Phased Deployments">Phased Deployments</a></li>
            <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform-Specific Details <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="platform-listing.html" title="Platform Listing">Platform Listing</a></li>
            <li><a href="db2-notes.html" title="DB2">DB2</a></li>
            <li><a href="general-db-notes.html" title="HSQLDB">HSQLDB</a></li>
            <li><a href="general-db-notes.html" title="H2">H2</a></li>
            <li><a href="mongodb-notes.html" title="MongoDB">MongoDB</a></li>
            <li><a href="oracle-notes.html" title="Oracle">Oracle</a></li>
            <li><a href="postgresql-notes.html" title="PostgreSQL">PostgreSQL</a></li>
            <li><a href="redshift-notes.html" title="Redshift">Redshift</a></li>
            <li><a href="sybase-ase-notes.html" title="SQL Server">SQL Server</a></li>
            <li><a href="sybase-ase-notes.html" title="Sybase ASE">Sybase ASE</a></li>
            <li><a href="general-db-notes.html" title="Sybase IQ">Sybase IQ</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onboarding Guide <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a></li>
            <li><a href="new-onboarding-guide.html" title="New Systems">New Systems</a></li>
            <li><a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a></li>
            <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards">Existing Systems with Diverging Shards</a></li>
            <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a></li>
            <li><a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Information <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
              <ul class="dropdown-menu">
                  <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup">Docker-based Test DB Setup</a></li>
                  <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup">Amazon RDS DB Setup</a></li>
                  <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup">Sybase ASE Test DB Setup</a></li>
              </ul>
            </li>
            <li><a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a></li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="./" id="bannerLeft"><h2>Obevo</h2>
</a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li class=""><a href="./" title="Obevo">Obevo</a><span class="divider">/</span></li>
    <li class="active ">Full Onboarding Guide for Existing Systems</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-06-14</li>
          <li id="projectVersion" class="pull-right">Version: master-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Getting Started</li>
    <li><a href="index.html" title="Intro"><span class="none"></span>Intro</a>  </li>
    <li><a href="overview.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="setup.html" title="Setup"><span class="none"></span>Setup</a>  </li>
    <li><a href="support.html" title="Help and Support"><span class="none"></span>Help and Support</a>  </li>
          <li class="nav-header">Technical Documentation</li>
    <li><a href="db-project-structure.html" title="DB Project Structure"><span class="none"></span>DB Project Structure</a>  </li>
    <li><a href="environment-management.html" title="Environment Management"><span class="none"></span>Environment Management</a>  </li>
    <li><a href="permission-management.html" title="Permission Management"><span class="none"></span>Permission Management</a>  </li>
    <li><a href="error-handling.html" title="Error-Handling"><span class="none"></span>Error-Handling</a>  </li>
          <li class="nav-header">API Documentation</li>
    <li><a href="command-line-api.html" title="Command-line API"><span class="none"></span>Command-line API</a>  </li>
    <li><a href="java-api.html" title="Java API"><span class="none"></span>Java API</a>  </li>
    <li><a href="maven-api.html" title="Maven plugin API"><span class="none"></span>Maven plugin API</a>  </li>
    <li><a href="gradle-api.html" title="Gradle API"><span class="none"></span>Gradle API</a>  </li>
          <li class="nav-header">Advanced Topics</li>
    <li><a href="db-project-best-practices.html" title="DB Project Best Practices"><span class="none"></span>DB Project Best Practices</a>  </li>
    <li><a href="rollback.html" title="Rollback"><span class="none"></span>Rollback</a>  </li>
    <li><a href="multiple-schema-management.html" title="Multiple Schema Management"><span class="none"></span>Multiple Schema Management</a>  </li>
    <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging"><span class="none"></span>Separate Schema and Config Packaging</a>  </li>
    <li><a href="in-memory-db-testing.html" title="In-memory DB Testing"><span class="none"></span>In-memory DB Testing</a>  </li>
    <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution"><span class="none"></span>Parallel Deploy Execution</a>  </li>
    <li><a href="orm-integration.html" title="ORM Integration"><span class="none"></span>ORM Integration</a>  </li>
    <li><a href="baseline-validation.html" title="Baseline DDL Validation"><span class="none"></span>Baseline DDL Validation</a>  </li>
    <li><a href="phased-deployments.html" title="Phased Deployments"><span class="none"></span>Phased Deployments</a>  </li>
    <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup"><span class="none"></span>Incremental Change Code Cleanup</a>  </li>
          <li class="nav-header">Platform-Specific Details</li>
    <li><a href="platform-listing.html" title="Platform Listing"><span class="none"></span>Platform Listing</a>  </li>
    <li><a href="db2-notes.html" title="DB2"><span class="none"></span>DB2</a>  </li>
    <li><a href="general-db-notes.html" title="HSQLDB"><span class="none"></span>HSQLDB</a>  </li>
    <li><a href="general-db-notes.html" title="H2"><span class="none"></span>H2</a>  </li>
    <li><a href="mongodb-notes.html" title="MongoDB"><span class="none"></span>MongoDB</a>  </li>
    <li><a href="oracle-notes.html" title="Oracle"><span class="none"></span>Oracle</a>  </li>
    <li><a href="postgresql-notes.html" title="PostgreSQL"><span class="none"></span>PostgreSQL</a>  </li>
    <li><a href="redshift-notes.html" title="Redshift"><span class="none"></span>Redshift</a>  </li>
    <li><a href="sybase-ase-notes.html" title="SQL Server"><span class="none"></span>SQL Server</a>  </li>
    <li><a href="sybase-ase-notes.html" title="Sybase ASE"><span class="none"></span>Sybase ASE</a>  </li>
    <li><a href="general-db-notes.html" title="Sybase IQ"><span class="none"></span>Sybase IQ</a>  </li>
          <li class="nav-header">Onboarding Guide</li>
    <li><a href="onboarding-guide.html" title="Which onboarding to choose?"><span class="none"></span>Which onboarding to choose?</a>  </li>
    <li><a href="new-onboarding-guide.html" title="New Systems"><span class="none"></span>New Systems</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Existing Systems</a>
  </li>
    <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards"><span class="none"></span>Existing Systems with Diverging Shards</a>  </li>
    <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems"><span class="none"></span>Legacy Onboarding - Legacy Systems</a>  </li>
    <li><a href="db-merge-tool.html" title="DB Merge Tool"><span class="none"></span>DB Merge Tool</a>  </li>
          <li class="nav-header">Developer Information</li>
    <li><a href="developer-guide.html" title="Developer Guide"><span class="icon-chevron-down"></span>Developer Guide</a>
      <ul class="nav nav-list">
    <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup"><span class="none"></span>Docker-based Test DB Setup</a>  </li>
    <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup"><span class="none"></span>Amazon RDS DB Setup</a>  </li>
    <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup"><span class="none"></span>Sybase ASE Test DB Setup</a>  </li>
      </ul>
  </li>
    <li><a href="design-walkthrough.html" title="Design Walkthrough"><span class="none"></span>Design Walkthrough</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!--

    Copyright 2017 Goldman Sachs.
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

--><h1>Full Onboarding Guide for Existing Systems</h1>

<ul>
<li><a href="#a1_Setup_your_environment_on_your_local_workstation">1) Setup your environment on your local workstation</a></li>
<li><a href="#a2_Create_a_blank_schema_to_test_your_deployment_against">2) Create a blank schema to test your deployment against</a></li>
<li><a href="#a3_Reverse-Engineering_the_DDLs_from_your_DB">3) Reverse-Engineering the DDLs from your DB</a></li>
<li><a href="#a4_Review_and_modify_the_system-config.xml_file">4) Review and modify the system-config.xml file</a></li>
<li><a href="#a5_optional_Import_your_static_data_as_CSV_or_inserts">5) (optional) Import your static data as CSV or inserts</a></li>
<li><a href="#a6_Execute_a_deployment_to_your_blank_schema_successfully">6) Execute a deployment to your blank schema successfully</a></li>
<li><a href="#a7_Marking_your_files_as_already_deployed_in_production">7) Marking your files as &#x2018;already deployed&#x2019; in production</a></li>
<li><a href="#a8_Complete_the_Adoption">8) Complete the Adoption</a></li></ul>
<p>This page outlines how to fully onboard an existing system to Obevo</p>
<p>At a high-level, the steps are:</p>

<ol style="list-style-type: decimal">
  
<li>Reverse-engineer your schema from production to set as your source code</li>
  
<li>Initialize your production and (optionally) UAT environments with Obevo</li>
  
<li>Do the recommended final steps mentioned in the <a href="new-onboarding-guide.html">Full Onboarding Guide for New Systems</a></li>
</ol>
<p>Note that this implies the production schema is your gold-standard for your code-base (as this is the exact schema already defined in production). Thus, you should discard any existing SQLs that you have been maintaining as they likely would not meet <i><u>both</u></i> of the following criteria:</p>

<ul>
  
<li>Be in the file-per-object format that Obevo desires</li>
  
<li>Be in sync with the actual schema in production</li>
</ul>
<p>One exception here is for static data tables (i.e. delete/insert statements for code tables / reference data tables / whatever your team calls them). Such code can easily be reusable.</p>
<p>Estimated time effort:</p>

<ul>
  
<li>For steps 1-6, a couple hours for a single instance and single schema of your production environment, which entail:
  
<ul>
    
<li>getting your schema generated from prod</li>
    
<li>re-deploying it to a blank dev db</li>
    
<li>and marking your production schema as &#x201c;deployed&#x201d; in the Deploy Log</li>
  </ul></li>
  
<li>At best, your full schema will be deployed to your dev DB; otherwise, most of your objects should be deployable</li>
  
<li>The rest of the steps (step &gt;= 7) are getting your UAT in line, knowledge transition to your teams, cleanups as necessary. This time would vary depending on your team&#x2019;s situation</li>
</ul>
<div class="section">
<h2><a name="a1_Setup_your_environment_on_your_local_workstation"></a>1) Setup your environment on your local workstation</h2>
<p>Follow these <a href="setup.html">instructions</a>. Do this from your regular desktop environment for ease of use (i.e. no need to run from a controlled environment at this point).</p></div>
<div class="section">
<h2><a name="a2_Create_a_blank_schema_to_test_your_deployment_against"></a>2) Create a blank schema to test your deployment against</h2>
<p>It is heavily suggested that that you dedicate a schema just for running the DB scripts. This will have multiple uses:</p>

<ul>
  
<li>As a sandbox for you defining your Obevo project</li>
  
<li>For comparing your deployed db against different environments to verify your DB scripts (or the state of your other environments)</li>
  
<li>For your continuous builds going forward (i.e. verifying your db scripts are fine as developers change it going forward)</li>
</ul></div>
<div class="section">
<h2><a name="a3_Reverse-Engineering_the_DDLs_from_your_DB"></a>3) Reverse-Engineering the DDLs from your DB</h2>
<p>The next step is to reverse-engineer your DB DDLs from your reference environment (likely your production environment) to serve as the starting point for your source code</p>
<p>We have a couple methodologies available for you to use, depending on your DBMS:</p>
<p><b><a href="reverse-engineer-dbmstools.html"><u>Option 1 (preferred): vendor-provided tools</u></a></b> (available for DB2, HSQLDB, Oracle, PostgreSQL, SQL Server, Sybase ASE)</p>

<ul>
  
<li>This option uses the tools provided by the vendors</li>
  
<li>It is relatively new compared to option 2, but it is the way we are investing in going forward.</li>
  
<li>Please reach out to the product team via Github if you have any questions in using this.</li>
</ul>
<p><b><a href="reverse-engineer-aquadatastudio.html"><u>Option 2 (legacy): Aqua Data Studio</u></a></b></p>

<ul>
  
<li>Aqua Data Studio is a tool previously used by the Obevo team in their regular DB-based work.</li>
  
<li>However, it is proprietary and not 100% accurate for some edge cases; hence, we invested in the vendor-provided tool approach.</li>
  
<li>That said, we already had the instructions for Aqua written, so we will continue to provide it for now.</li>
</ul>
<p>Note that none of the methodologies would include reverse-engineering the grants, as we recommend teams to use the <a href="permission-management.html">Permission Management</a> functionality instead</p></div>
<div class="section">
<h2><a name="a4_Review_and_modify_the_system-config.xml_file"></a>4) Review and modify the system-config.xml file</h2>
<p>The schema reverse-engineering step will generate a system-config.xml file for you in your output directory based on the parameters you provided. Review it and modify it accordingly</p>
<p>To start with:</p>

<ul>
  
<li>The source of your reverse-engineering (as specified by your arguments in the previous step) will be named as the &#x201c;prod&#x201d; environment in your config, with a separate placeholder environment for your dev</li>
  
<li>Use the placeholder dev environments for your deploys during testing</li>
  
<li>Rename the &lt;schema&gt; entry to become the logical schema name that you want</li>
  
<li>Use the <a class="externalLink" href="https://github.com/goldmansachs/obevo-kata/tree/master/src/main/database/system-config.xml">kata system-config.xml file</a> as a further sample to model from if needed</li>
</ul></div>
<div class="section">
<h2><a name="a5_optional_Import_your_static_data_as_CSV_or_inserts"></a>5) (optional) Import your static data as CSV or inserts</h2>
<div class="section">
<h3><a name="How_To_Generate_the_CSV_Files"></a>How To Generate the CSV Files</h3>

<div class="source">
<div class="source"><pre class="prettyprint">## required args:
    %OBEVO_HOME%\bin\deploy.bat DBREVENG -mode data -inputDir %s -outputDir %s -dbType %s -dbHost %s -dbPort %d -dbSchema %s -username %s -password %s

## optional args:
# 1) you can add this for DB2
    -dbServer &amp;lt;serverName&amp;gt; # for DB2 databases that require a server parameter
# 2) one of the following is required, but not both
    -tables table1,table2,table3,... # comma-separated list of tables to reverse-engineer
  or
    -inputDir dir # dir containing a file static-data-tables.txt that has the list of tables, one per line (you can use this in case you have many tables that are hard to pass in by command line)

# 3) If you want to automatically detect certain columns as &amp;quot;updateTime columns&amp;quot; and generate the CSV files as such, use this arg. The &amp;quot;updateTime column&amp;quot; concept is explained below
    -updateTimeColumns col1,col2
</pre></div></div>
<p>Clarification for certain params:</p>

<ul>
  
<li>-outputDir will have the CSV files written there</li>
  
<li>-dbType should be SYBASE*IQ, SYBASE*ASE, DB2</li>
  
<li>-updateTimeColumns:
  
<ul>
    
<li>Often times when we have static data tables, we&#x2019;d denote a field like updateTime for audit purposes, i.e. to indicate when the row was added or inserted</li>
    
<li>But if we define the static data in your source code, then you can&#x2019;t truly add the updateTime column at the same time, as that will get deployed later</li>
    
<li>Hence, we allow users to define certain columns as &#x201c;updateTime columns&#x201d;, such that the tool will automatically set this value to the current time whenever the row is inserted or updated</li>
    
<li>To do this, you would add the following metadata tag at the start of your CSV file: (the value is singular: only 1 column can be denoted as such)</li>
  </ul></li>
</ul>
<p>//// METADATA updateTimeColumn=&#x201c;col1&#x201d; &#x2026;</p>

<ul>
  
<li>In terms of the reverse-engineering:
  
<ul>
    
<li>The arg defined in the reverse engineering is to specify which columns you expect to be used as such, as teams may have certain conventions, e.g. timeUpdated, updTmstmp, &#x2026;</li>
    
<li>The reveng arg is plural in case you happen to have multiple such columns</li>
  </ul></li>
</ul></div>
<div class="section">
<h3><a name="Generating_the_data_as_Insert_statements"></a>Generating the data as Insert statements</h3>
<p>If you can&#x2019;t or don&#x2019;t want to maintain your static data as CSVs, and want to keep it as inserts, you can use Aqua to do this (i.e. Tools -&gt; Export Data), or define these files manually, or whatever other method that you have</p></div></div>
<div class="section">
<h2><a name="a6_Execute_a_deployment_to_your_blank_schema_successfully"></a>6) Execute a deployment to your blank schema successfully</h2>
<p>Use the deployment command as mentioned earlier to deploy your newly-created files into the test schema you setup in step 2 earlier <b>including adding the -onboardMode flag to help w/ the onboarding</b>. The point of the deployment is so we can verify that the scripts are valid.</p>
<p>Please perform a successful deployment before proceeding to the next step</p>

<div class="source">
<div class="source"><pre class="prettyprint">%OBEVO_HOME%\bin\deploy.bat DEPLOY -sourcePath src/main/database -env test -onboardingMode
</pre></div></div>
<p>In Obevo, we strove to make the reverse-engineering as smooth as possible, so hopefully it will be successful on the first try. But for various reasons, it may not. Hence, you should iteratively deploy, review the logs, fix problems, and redeploy until all issues are fixed.</p>
<div class="section">
<h3><a name="Explaining_the_-onboardingMode_flag"></a>Explaining the -onboardingMode flag</h3>
<p>As the deployment described here will be an iterative process to find and then resolve issues, it becomes important to easily identify exceptions. The onboarding mode helps via the following:</p>
<p>1) Any files that cause exceptions will get moved into either the /exceptions or /dependentOnExceptions folders, and will have a separate &#x201c;.exceptions&#x201d; file created containing the exceptions you have.</p>

<ul>
  
<li>/exceptions gets created for normal cases.</li>
  
<li>/dependentOnExceptions is created if we detect that the exception was caused due to an earlier exception on another object (i.e. something already in /exceptions</li>
</ul>
<p>2) Upon correction of SQL files and subsequent rerun, files will get moved back to the home folder</p></div>
<div class="section">
<h3><a name="Onboarding_workflow"></a>Onboarding workflow</h3>
<p>Your workflow then specifically becomes the following:</p>

<ul>
  
<li>1) Run a deployment using -onboardingMode with your reverse-engineered DDLs</li>
  
<li>2) Fix the issues you see in the objects stored in /exceptions, whether by fixing SQLs (see notes below), fixing the DB environment itself, or deleting the file and choosing not to maintain it.</li>
  
<li>(leave the &#x201c;dependentOnExceptions&#x201d; alone for now)</li>
  
<li>3) Rerun the deployment w/ the -onboardingMode command. You should expect the /exceptions objects you just fixed to be successfully deployed. This means the objects in /dependentOnExceptions now have a chance to succeed. If they do, they will get moved to the regular folder. If not, they will get moved to the /exceptions folder</li>
  
<li>4) Go back to step 2 and repeat steps 2-4 until there are no more exceptions during your run</li>
  
<li>5) Do a final full-deploy (i.e. cleanEnvironment, followed by deploy) to help ensure that the SQLs are actually valid and compatible w/ all environments</li>
</ul></div>
<div class="section">
<h3><a name="Common_problems_encountered__resolution_steps"></a>Common problems encountered + resolution steps</h3>

<ul>
  
<li>Objects may refer to other non-existent objects (e.g. views or stored procedures referring to tables that no longer exist). This can particularly happen for long-lived systems
  
<ul>
    
<li>A suggestion here is to do a grep on the log file of the deployment that you tried for the SQL error that indicates a reference to an object that doesn&#x2019;t exist (e.g. for Sybase, the message is &#x201c;nested exception is com.sybase.jdbc3.jdbc.SybSQLException: ArchivingCandidate not found. Specify owner.objectname or use sp*help to check whether the object exists (sp*help may produce lots of output)&#x201d;. Hence, you can try grepping for &#x201c;not found&#x201d;</li>
    
<li>Once you get that list, send it out to your team (possibly w/ the object that referred to it) to see if these objects are actually needed. Likely, you should be able to delete these objects (definitely delete them from your source code, and drop them in production prior to onboarding)</li>
  </ul></li>
  
<li>Views/stored procedures/triggers that are referring to objects in other schemas. Depending on your situation, you may either:
  
<ul>
    
<li>need to tokenize the schema name in case it is different on your dev env vs. production (e.g. account*master*dev vs. accountmaster)</li>
    
<li>see that the dependent object exists in prod but not dev. In that case, look to get that schema cleaned up (potentially via Obevo? You can do that as a separate project)</li>
  </ul></li>
  
<li>Circular dependencies in stored procedures that the default algorithm could not detect (maybe due to comments in your files). In these cases, add the includeDependencies/excludeDependencies as needed (see earlier parts in this doc for reference)</li>
  
<li>(For Sybase ASE) The stored procedure may have been relying on a pre-existing temp table (i.e. the client app creates the temp table, populates the data, then calls the SP that uses the temp table).
  
<ul>
    
<li>In this case, you must create the temp table before creating the SP. Though the temp table won&#x2019;t exist outside the connection, the SP will remember the name and structure, and thus expect it to be created when called</li>
    
<li>To handle this case, just add the &#x201c;create temp table&#x201d; statement in your SP file prior to the &#x201c;create procedure&#x201d; statement, and then add a &#x201c;drop temp table&#x201d; statement after the actual SP sql (all within the same file)
    
<ul>
      
<li>See the example below for reference</li>
    </ul></li>
  </ul></li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">create table #MyTemp (
    FieldA varchar(32),
    FieldB int
)
GO
create proc SpWithTemp (@MaxCount int) as
begin
    select * from #MyTemp

    // Do whatever processing you need
end
GO
drop table #MyTemp /* cleanup */
GO
</pre></div></div>

<ul>
  
<li>For the staticData loads, a couple common issues may arise:
  
<ul>
    
<li>If the table does not have a primary key, then the CSV mode will not work, as mentioned earlier in the docs. Either add the PK to the table, or switch to the delete/insert mode</li>
    
<li>If your data includes a backslash (i.e. ), then you need to convert it to escape it w/ another quote (i.e. \\ ). This is because of a bug w/ the underlying CSV reader implementation <a class="externalLink" href="http://opencsv.sourceforge.net/">OpenCSV</a> (which otherwise is truly an excellent library!)</li>
  </ul></li>
</ul>
<p>If you run into any other kinds of problems that you cannot seem to debug, feel free to reach out to the Obevo team</p></div></div>
<div class="section">
<h2><a name="a7_Marking_your_files_as_already_deployed_in_production"></a>7) Marking your files as &#x2018;already deployed&#x2019; in production</h2>
<p>Once you&#x2019;ve gotten your DDLs into a good shape (i.e. doing the reverse engineering, deploying your code against the blank schema, then comparing that deployed schema against prod via Aqua to verify correctness), then essentially, you can assume that your prod db have been deployed via obevo</p>
<p>But - the audit table does not exist yet in production. You will have to seed it w/ the audit trail such that Obevo can deploy any new changes going forward</p>
<p>To do this, run the INIT command</p>

<div class="source">
<div class="source"><pre class="prettyprint">%OBEVO_HOME%\bin\deploy.bat INIT -sourcePath src/main/database
</pre></div></div>
<p>Do the same for the rest of your environments (e.g. qa, uat) if needed</p>
<p>In case you have some ddls in uat but not production, the suggestion is to:</p>

<ul>
  
<li>first create baseline DDLs based off prod</li>
  
<li>then run init-env for prod</li>
  
<li>then add your migration script in your source code for your other envs, e.g. uat</li>
  
<li>then run init-env for the other env, e.g. uat</li>
  
<li>repeat if you have yet another layer of changes (e.g. dev or qa)</li>
</ul></div>
<div class="section">
<h2><a name="a8_Complete_the_Adoption"></a>8) Complete the Adoption</h2>
<p>The above steps are easy - doing the final &#x201c;production&#x201d; touches is the harder part, IMO. The time and effort to do this would vary depending on your team situation</p>
<div class="section">
<h3><a name="Apply_this_to_your_other_environments"></a>Apply this to your other environments</h3>
<div class="section">
<h4><a name="UATs"></a>UATs</h4>
<p>You likely will have a number of dev/qa/uat environments already up and running. We&#x2019;d need to onboard these to Obevo too, and it is possible that these environments are not in sync with production (hence, they are out of sync with the db scripts you just created)</p>
<p>You have 2 options to work around this:</p>
<p>1) Wipe away the UAT environment and recreate (whether via devsync or via Obevo -cleanFirst invocation)</p>
<p>This is the easy option if you don&#x2019;t have any ongoing UATs or can easily start over</p>
<p>2) Manually compare and apply any changes to the UAT environment, and then apply the &#x201c;INIT&#x201d; command mentioned in step 7</p>
<p>In the case that you cannot just start afresh, you may need to do manual reconciliations and comparisons to get your UAT in line. This is not that great an option, but depending on your team&#x2019;s situation, it may be needed</p>
<p>To compare the schemas, use any DB management tool of your choice. <a class="externalLink" href="http://sualeh.github.io/SchemaCrawler/">SchemaCrawler</a>, which is used as a library in Obevo, also has comparison functionality.</p>
<p>To compare the static data, see the following subsection&#x2026;</p></div>
<div class="section">
<h4><a name="Comparing_the_Data_across_different_databases"></a>Comparing the Data across different databases</h4>
<p>When defining your static data files, it may help to do comparisons between different databases (e.g. prod vs. uat, your deployed code vs. prod) in case you are starting from a very unmanaged state (i.e. no static data files checked in, not sure of the states your various dbs are in)</p>
<p>To do that - run the following command. It will let you do compare a list of tables that you define against the dbs that you define (you can define any number of 2-way compares). The tool will output the differences in Excel files (a summary report defining the overall differences, plus detailed reports for cases where content exists in either side of a comparison, but there are differences)</p>

<div class="source">
<div class="source"><pre class="prettyprint">j:\cc\obevo\bin\deploy.bat DBDATACOMPARE -configFile H:\mydir\costarRepoComparisonConfig.properties -outputDir H:\mycomparisons\
</pre></div></div>
<p>Config File Example: <a href="files/dbComparisonConfigExample.properties">dbComparisonConfigExample.properties</a></p>
<p>Format:</p>

<ul>
  
<li>tables.include &#x2013; tables you want to check (you must define this)</li>
  
<li>tables.exclude &#x2013; tables you don&#x2019;t want to check (you can leave blank if you choose &#x2013; this is more of a convenience in case you were incrementally working on the comparison and wanted )</li>
  
<li>comparisons &#x2013; define the 2-way comparisons that you want to do. E.g. the string &#xe2;&#x20ac;&#x153;dev1,uat;uat,prod1;dev1,prod2&#xe2;&#x20ac;? will do the following comparisons:
  
<ul>
    
<li>dev1 vs. uat</li>
    
<li>uat vs. prod1</li>
    
<li>dev1 vs. prod2</li>
    
<li>Then you have an entry for each of the data sources that you define, and you must define the schema/url/username/password/driverClass for each</li>
  </ul></li>
</ul></div></div>
<div class="section">
<h3><a name="Cleanup_oldunmaintained_objects_as_you_see_fit"></a>Cleanup old/unmaintained objects as you see fit</h3>

<ul>
  
<li>Note - we ultimately are planning on a utility GITHUB#1 to cleanup any objects that are in the environment and not in the source code. Till then, you can try the following manual cleanup options.</li>
  
<li>Removing backup tables from production (e.g. Transaction*bkup, Transaction*20130101)
  
<ul>
    
<li>The suggestion is that you do not include these tables into your code base - delete them before you do the INIT command (if you already did the INIT command, you can just run it again after your changes). Drop these manually from production (I&#x2019;d do this manually as the tool currently does not support dropping tables - better safe than sorry from a tooling perspective! though we will eventually support this)</li>
  </ul></li>
  
<li>Removing unused views/sps
  
<ul>
    
<li>In this case, I &#x201c;would&#x201d; keep these in your Obevo codebase, as after your init command, you can then delete these in a controlled manner. (I&#x2019;m less worried about the risk of dropping stored procedures, as you can easily add them back)</li>
  </ul></li>
</ul></div>
<div class="section">
<h3><a name="See_rest_of_recommended_steps"></a>See rest of recommended steps&#x2026;</h3>
<p>Follow the rest of the guidance on &#x201c;More Recommended Steps&#x201d; in <a href="new-onboarding-guide.html">Full Onboarding Guide for New Systems</a></p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2019
<a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
