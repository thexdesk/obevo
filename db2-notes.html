<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2019-06-14 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190614" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Obevo &#x2013; DB2 Notes</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                      <a href="https://github.com/goldmansachs/obevo">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Intro">Intro</a></li>
            <li><a href="overview.html" title="Overview">Overview</a></li>
            <li><a href="setup.html" title="Setup">Setup</a></li>
            <li><a href="support.html" title="Help and Support">Help and Support</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a></li>
            <li><a href="environment-management.html" title="Environment Management">Environment Management</a></li>
            <li><a href="permission-management.html" title="Permission Management">Permission Management</a></li>
            <li><a href="error-handling.html" title="Error-Handling">Error-Handling</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="command-line-api.html" title="Command-line API">Command-line API</a></li>
            <li><a href="java-api.html" title="Java API">Java API</a></li>
            <li><a href="maven-api.html" title="Maven plugin API">Maven plugin API</a></li>
            <li><a href="gradle-api.html" title="Gradle API">Gradle API</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced Topics <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a></li>
            <li><a href="rollback.html" title="Rollback">Rollback</a></li>
            <li><a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a></li>
            <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging">Separate Schema and Config Packaging</a></li>
            <li><a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a></li>
            <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a></li>
            <li><a href="orm-integration.html" title="ORM Integration">ORM Integration</a></li>
            <li><a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a></li>
            <li><a href="phased-deployments.html" title="Phased Deployments">Phased Deployments</a></li>
            <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform-Specific Details <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="platform-listing.html" title="Platform Listing">Platform Listing</a></li>
            <li><a href="db2-notes.html" title="DB2">DB2</a></li>
            <li><a href="general-db-notes.html" title="HSQLDB">HSQLDB</a></li>
            <li><a href="general-db-notes.html" title="H2">H2</a></li>
            <li><a href="mongodb-notes.html" title="MongoDB">MongoDB</a></li>
            <li><a href="oracle-notes.html" title="Oracle">Oracle</a></li>
            <li><a href="postgresql-notes.html" title="PostgreSQL">PostgreSQL</a></li>
            <li><a href="redshift-notes.html" title="Redshift">Redshift</a></li>
            <li><a href="sybase-ase-notes.html" title="SQL Server">SQL Server</a></li>
            <li><a href="sybase-ase-notes.html" title="Sybase ASE">Sybase ASE</a></li>
            <li><a href="general-db-notes.html" title="Sybase IQ">Sybase IQ</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onboarding Guide <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a></li>
            <li><a href="new-onboarding-guide.html" title="New Systems">New Systems</a></li>
            <li><a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a></li>
            <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards">Existing Systems with Diverging Shards</a></li>
            <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a></li>
            <li><a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Information <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
              <ul class="dropdown-menu">
                  <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup">Docker-based Test DB Setup</a></li>
                  <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup">Amazon RDS DB Setup</a></li>
                  <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup">Sybase ASE Test DB Setup</a></li>
              </ul>
            </li>
            <li><a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a></li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="./" id="bannerLeft"><h2>Obevo</h2>
</a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li class=""><a href="./" title="Obevo">Obevo</a><span class="divider">/</span></li>
    <li class="active ">DB2 Notes</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-06-14</li>
          <li id="projectVersion" class="pull-right">Version: master-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Getting Started</li>
    <li><a href="index.html" title="Intro"><span class="none"></span>Intro</a>  </li>
    <li><a href="overview.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="setup.html" title="Setup"><span class="none"></span>Setup</a>  </li>
    <li><a href="support.html" title="Help and Support"><span class="none"></span>Help and Support</a>  </li>
          <li class="nav-header">Technical Documentation</li>
    <li><a href="db-project-structure.html" title="DB Project Structure"><span class="none"></span>DB Project Structure</a>  </li>
    <li><a href="environment-management.html" title="Environment Management"><span class="none"></span>Environment Management</a>  </li>
    <li><a href="permission-management.html" title="Permission Management"><span class="none"></span>Permission Management</a>  </li>
    <li><a href="error-handling.html" title="Error-Handling"><span class="none"></span>Error-Handling</a>  </li>
          <li class="nav-header">API Documentation</li>
    <li><a href="command-line-api.html" title="Command-line API"><span class="none"></span>Command-line API</a>  </li>
    <li><a href="java-api.html" title="Java API"><span class="none"></span>Java API</a>  </li>
    <li><a href="maven-api.html" title="Maven plugin API"><span class="none"></span>Maven plugin API</a>  </li>
    <li><a href="gradle-api.html" title="Gradle API"><span class="none"></span>Gradle API</a>  </li>
          <li class="nav-header">Advanced Topics</li>
    <li><a href="db-project-best-practices.html" title="DB Project Best Practices"><span class="none"></span>DB Project Best Practices</a>  </li>
    <li><a href="rollback.html" title="Rollback"><span class="none"></span>Rollback</a>  </li>
    <li><a href="multiple-schema-management.html" title="Multiple Schema Management"><span class="none"></span>Multiple Schema Management</a>  </li>
    <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging"><span class="none"></span>Separate Schema and Config Packaging</a>  </li>
    <li><a href="in-memory-db-testing.html" title="In-memory DB Testing"><span class="none"></span>In-memory DB Testing</a>  </li>
    <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution"><span class="none"></span>Parallel Deploy Execution</a>  </li>
    <li><a href="orm-integration.html" title="ORM Integration"><span class="none"></span>ORM Integration</a>  </li>
    <li><a href="baseline-validation.html" title="Baseline DDL Validation"><span class="none"></span>Baseline DDL Validation</a>  </li>
    <li><a href="phased-deployments.html" title="Phased Deployments"><span class="none"></span>Phased Deployments</a>  </li>
    <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup"><span class="none"></span>Incremental Change Code Cleanup</a>  </li>
          <li class="nav-header">Platform-Specific Details</li>
    <li><a href="platform-listing.html" title="Platform Listing"><span class="none"></span>Platform Listing</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>DB2</a>
  </li>
    <li><a href="general-db-notes.html" title="HSQLDB"><span class="none"></span>HSQLDB</a>  </li>
    <li><a href="general-db-notes.html" title="H2"><span class="none"></span>H2</a>  </li>
    <li><a href="mongodb-notes.html" title="MongoDB"><span class="none"></span>MongoDB</a>  </li>
    <li><a href="oracle-notes.html" title="Oracle"><span class="none"></span>Oracle</a>  </li>
    <li><a href="postgresql-notes.html" title="PostgreSQL"><span class="none"></span>PostgreSQL</a>  </li>
    <li><a href="redshift-notes.html" title="Redshift"><span class="none"></span>Redshift</a>  </li>
    <li><a href="sybase-ase-notes.html" title="SQL Server"><span class="none"></span>SQL Server</a>  </li>
    <li><a href="sybase-ase-notes.html" title="Sybase ASE"><span class="none"></span>Sybase ASE</a>  </li>
    <li><a href="general-db-notes.html" title="Sybase IQ"><span class="none"></span>Sybase IQ</a>  </li>
          <li class="nav-header">Onboarding Guide</li>
    <li><a href="onboarding-guide.html" title="Which onboarding to choose?"><span class="none"></span>Which onboarding to choose?</a>  </li>
    <li><a href="new-onboarding-guide.html" title="New Systems"><span class="none"></span>New Systems</a>  </li>
    <li><a href="existing-onboarding-guide.html" title="Existing Systems"><span class="none"></span>Existing Systems</a>  </li>
    <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards"><span class="none"></span>Existing Systems with Diverging Shards</a>  </li>
    <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems"><span class="none"></span>Legacy Onboarding - Legacy Systems</a>  </li>
    <li><a href="db-merge-tool.html" title="DB Merge Tool"><span class="none"></span>DB Merge Tool</a>  </li>
          <li class="nav-header">Developer Information</li>
    <li><a href="developer-guide.html" title="Developer Guide"><span class="icon-chevron-down"></span>Developer Guide</a>
      <ul class="nav nav-list">
    <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup"><span class="none"></span>Docker-based Test DB Setup</a>  </li>
    <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup"><span class="none"></span>Amazon RDS DB Setup</a>  </li>
    <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup"><span class="none"></span>Sybase ASE Test DB Setup</a>  </li>
      </ul>
  </li>
    <li><a href="design-walkthrough.html" title="Design Walkthrough"><span class="none"></span>Design Walkthrough</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!--

    Copyright 2017 Goldman Sachs.
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

--><h1>DB2 Notes</h1>
<p>DB Type acronym for configurations: DB2</p>

<ul>
<li><a href="#Specifying_tablespace_for_user_tables_and_Obevo_audit_tables">Specifying tablespace for user tables and Obevo audit tables</a></li>
<li><a href="#DB2_Reorg_Detection_and_Support">DB2 Reorg Detection and Support</a></li>
<li><a href="#DB2_Invalid_Object_Detection_and_Recompilation">DB2 Invalid Object Detection and Recompilation</a></li>
<li><a href="#Configuring_the_DB2_post-deploy_and_reorg_behaviors">Configuring the DB2 post-deploy and reorg behaviors</a></li>
<li><a href="#aInvalid_operation:_Lob_is_closed_Exception">&#x201c;Invalid operation: Lob is closed&#x201d; Exception</a></li>
<li><a href="#DB2_Error_Message_Handling">DB2 Error Message Handling</a></li></ul>
<div class="section">
<h2><a name="Specifying_tablespace_for_user_tables_and_Obevo_audit_tables"></a>Specifying tablespace for user tables and Obevo audit tables</h2>
<p>Note the following if you follow the convention of explicitly defining the tablespace for tables in your SQL commands, e.g.</p>

<div class="source">
<div class="source"><pre class="prettyprint">CREATE TABLE mytable ( ... ) IN mytablespace
</pre></div></div>

<ul>
  
<li>To specify the tablespace for user tables, simply define it in your SQL. You can parameterize that value across environments as needed using the <a href="environment-management.html">tokenization feature</a></li>
  
<li>Note that Obevo can automatically remove such clauses for translations to unit test databases; for more information,  see <a href="in-memory-db-testing.html">here</a></li>
  
<li>To specify the tablespapce for the Obevo-managed tables (e.g. ARTIFACTDEPLOYMENT), specify the defaultTablespace attribute in your environment configs, e.g. <tt>
&lt;dbEnvironment name=&quot;dev1&quot; defaultTablespace=&quot;mydevtablespace&quot; ...&gt;
</tt></li>
  
<li>A token ${defaultTablespace} will be available to use if you leverage this attribute, e.g. <tt>
CREATE TABLE mytable ( ... ) IN ${defaultTablespace}
</tt></li>
</ul></div>
<div class="section">
<h2><a name="DB2_Reorg_Detection_and_Support"></a>DB2 Reorg Detection and Support</h2>
<p>Obevo supports the handling of reorgs in 2 places:</p>

<ul>
  
<li>If any SQL is executed and returns the DB2 reorg-pending error (-668), Obevo will detect this and automatically fire off the reorg statement (you can disable the automatic firing of the reorg in system-config.xml; see section below)</li>
  
<li>At the end of a deployment, Obevo will check if any tables are pending reorg using the query below, and if any are detected, it will show the results to you and fire the reorg (unless you&#x2019;ve disabled the automatic firing of the reorg, in which case you&#x2019;ll just see the list of affected tables)</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">SELECT TABSCHEMA, TABNAME, NUM_REORG_REC_ALTERS, REORG_PENDING
FROM SYSIBMADM.ADMINTABINFO
WHERE TABSCHEMA IN ('schema1','schema2') AND REORG_PENDING = 'Y'
</pre></div></div>
<p>Both use cases need to be supported as it can be possible to modify a table that is pending reorg without incurring the error (the error is only incurred if you try to use the data in it), and so you need a check after the fact.</p></div>
<div class="section">
<h2><a name="DB2_Invalid_Object_Detection_and_Recompilation"></a>DB2 Invalid Object Detection and Recompilation</h2>
<p>Existing objects can become invalid if a dependent object is modified in certain ways; DB2 terms these as invalid objects. Obevo can detect if <a class="externalLink" href="http://www.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.sql.ref.doc/doc/r0054588.html">such objects exist after your deployment</a> and <a class="externalLink" href="http://www.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.sql.rtn.doc/doc/r0053626.html">recompile them if possible</a>.</p>
<p>This behavioral is configurable - see section below.</p></div>
<div class="section">
<h2><a name="Configuring_the_DB2_post-deploy_and_reorg_behaviors"></a>Configuring the DB2 post-deploy and reorg behaviors</h2>
<p>The following parameters are available to configure:</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Property</th>
      
<th>Default Value</th>
      
<th>Description</th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td>reorgCheckEnabled</td>
      
<td>true</td>
      
<td>If true, will execute the query to find all tables that require reorg. This property does not determine whether the reorg is executed</td>
    </tr>
    
<tr class="a">
      
<td>autoReorgEnabled</td>
      
<td>true</td>
      
<td>If true, will execute a reorg automatically if detected during deployment or the post-deployment step. If reorgCheckEnabled==false, then no reorgs will run during the post-deploy step, regardless of the autoReorgEnabled value</td>
    </tr>
    
<tr class="b">
      
<td>invalidObjectCheckEnabled</td>
      
<td>true</td>
      
<td>If true, will execute the invalid-object check and recompilation in the post-deployment step.</td>
    </tr>
  </tbody>
</table>
<p>You have the choice to configure the behaviors above either at the dbSystemConfig or dbEnvironment levels, e.g.</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;dbSystemConfig autoReorgEnabled=&quot;false&quot; ...&gt;   &lt;!-- Set the default value here --&gt;
    &lt;!-- ... --&gt;
    &lt;environments&gt;
        &lt;dbEnvironment name=&quot;env1&quot; ... /&gt;  &lt;!-- inherits the default value from the top level --&gt;
        &lt;dbEnvironment name=&quot;env2&quot; autoReorgEnabled=&quot;true&quot; ... /&gt;  &lt;!-- overrides the default value --&gt;
</pre></div></div></div>
<div class="section">
<h2><a name="aInvalid_operation:_Lob_is_closed_Exception"></a>&#x201c;Invalid operation: Lob is closed&#x201d; Exception</h2>
<p>If you receive this exception, you should add the progressiveStreaming=false value to your JDBC url, per below. More details <a class="externalLink" href="https://pdn.pega.com/support-articles/pega-718-installation-db2-fails-lob-closed-error">here</a></p>

<div class="source">
<div class="source"><pre class="prettyprint">jdbc:db2://localhost:50000/dbdeploy:progressiveStreaming=false;
</pre></div></div>
<p>We have only seen this in the DB2 Express environment so far. If you run into this in your own standard environment, please raise an issue on Github.</p></div>
<div class="section">
<h2><a name="DB2_Error_Message_Handling"></a>DB2 Error Message Handling</h2>
<p>Error messages in DB2 will appear somewhat as follows:</p>

<div class="source">
<div class="source"><pre class="prettyprint">Caused by: com.ibm.db2.jcc.b.SqlException: DB2 SQL error: SQLCODE: -750, SQLSTATE: 42986, SQLERRMC: null
</pre></div></div>
<p>If you see such an exception, first search via the SQLCODE for a hint of the problem.</p>
<p>For the example above, do a search like &#x201c;db2 error code 750&#x201d; to find the issue. This usually leads to the <a class="externalLink" href="https://www.ibm.com/support/knowledgecenter/en/SSEPEK_10.0.0/codes/src/tpc/n750.html">DB2 error code reference page</a>.</p>
<p>If the error message does not help you, then reach to your database administrators or contact the Obevo team.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2019
<a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
